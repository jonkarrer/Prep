<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/pages/auth/styles/auth.css" />
    <script type="module" src="/pages/global/components/index.js"></script>

    <title>Authentication</title>
  </head>
  <body>
    <div id="left_panel" class="Video show">
      <img src="/assets/left_panel.png" alt="" />
    </div>

    <main>
      <header>
        <div class="Logo">
          <img src="/assets/brand/prep_logo_light.svg" />
        </div>
        <nav>
          <a href="/">About</a>
          <a href="/products">Products</a>
        </nav>
      </header>

      <div class="Icons">
        <img src="/assets/icons/apple-solid.svg" />
        <img src="/assets/icons/cookie-outline.svg" />
        <img src="/assets/icons/herb-outline.svg" />
      </div>

      <div class="Stack">
        <img class="Emblem" src="/assets/icons/emblem-hex-dots-lines.svg" />
        <h1>Prep</h1>

        <form action="/auth/login" method="POST" id="login_form" class="show">
          <input
            type="email"
            name="email"
            placeholder="Email Address"
            title="Enter an email address"
          />
          <input
            type="password"
            name="password"
            placeholder="Password"
            title="Enter your password"
          />
          <button type="submit">Login</button>
        </form>

        <form action="/auth/register" method="POST" id="register_form">
          <input
            type="email"
            name="email"
            placeholder="Email Address"
            title="Enter your email address"
          />
          <input
            type="password"
            name="password"
            placeholder="Password"
            title="At least 8 characters with a number and uppercase letter"
          />

          <input name="confirm_password" placeholder="Confirm Password" />

          <button type="submit">Register</button>
        </form>

        <a class="Link show" onclick="swapForms(event)" id="sign_up_link"
          >Sign Up</a
        >
        <a class="Link" onclick="swapForms(event)" id="sign_in_link">Sign In</a>

        <div class="Slider">
          <p id="slider_text">
            Organize your kitchen with Prep, the generative recipe system.
          </p>
          <span class="Slider--dots_container">
            <span id="dot_one" class="Dot Dot--filled"></span>
            <span id="dot_two" class="Dot"></span>
            <span id="dot_three" class="Dot"></span>
          </span>
        </div>
      </div>

      <div class="Icons">
        <img src="/assets/icons/fruit-bowl-outline.svg" />
        <img src="/assets/icons/lotus-solid.svg" />
        <img src="/assets/icons/rice-bowl-solid.svg" />
      </div>
    </main>

    <script>
      const loginForm = document.getElementById("login_form");
      const registerForm = document.getElementById("register_form");
      loginForm.addEventListener("submit", submitForm);
      registerForm.addEventListener("submit", submitForm);

      const signInLink = document.getElementById("sign_in_link");
      const signUpLink = document.getElementById("sign_up_link");

      function showRegisterForm() {
        signInLink.classList.add("show");
        registerForm.classList.add("show");

        signUpLink.classList.remove("show");
        loginForm.classList.remove("show");
      }

      function showLoginForm() {
        signUpLink.classList.add("show");
        loginForm.classList.add("show");

        signInLink.classList.remove("show");
        registerForm.classList.remove("show");
      }

      function swapForms(e) {
        const id = e.target.id;

        id === "sign_up_link" ? showRegisterForm() : showLoginForm();
      }

      function transitionSliderText(index) {
        let textEl = document.getElementById("slider_text");
        textEl.classList.add("fade-in");

        textEl.innerText = [
          "Organize your kitchen with Prep, the generative recipe system.",
          "Don't let a great dish be forgotten, let Prep save it for next time.",
          "Prep will help you learn, understand, and execute any recipe",
        ][index];

        setTimeout(() => textEl.classList.remove("fade-in"), 2000);
      }

      function transitionFilledDot(index) {
        let dot_one = document.getElementById("dot_one");
        let dot_two = document.getElementById("dot_two");
        let dot_three = document.getElementById("dot_three");

        let dots = [dot_one, dot_two, dot_three];

        let currDot = dots[index];
        let prevDot = dots[index - 1 === -1 ? 2 : index - 1];

        currDot.classList.toggle("Dot--filled");
        currDot.classList.add("fill-in");

        prevDot.classList.toggle("Dot--filled");

        setTimeout(() => currDot.classList.remove("fill-in"), 2000);
      }

      let i = 1;
      setInterval(() => {
        transitionSliderText(i);
        transitionFilledDot(i);

        i = i === 2 ? 0 : (i += 1);
      }, 5000);

      async function submitForm(event) {
        event.preventDefault();

        const formData = new FormData(event.target);
        const path = event.target.action;
        const method = event.target.method;
        const body = new URLSearchParams(formData).toString();

        let res = await fetch(path, {
          method: method,
          headers: {
            "Content-Type": "application/x-www-form-urlencoded",
          },
          redirect: "follow",
          body: body,
        });

        if (res.redirected) {
          window.location = res.url;
        } else {
          let text = await res.text();
          handleToast("error", text);
        }
      }
    </script>
  </body>
</html>
